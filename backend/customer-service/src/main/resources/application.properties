# Server
spring.application.name=customer-service
server.port=8082

#core-bank
core-banking.base-url=http://localhost:8088

# Datasource
spring.datasource.url=jdbc:mysql://localhost:3306/customer_db?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
spring.datasource.username=root
spring.datasource.password=123456
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPA / Hibernate
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# Logging
logging.level.org.springframework=INFO
logging.level.com.example.customerservice=DEBUG

# Redis (Spring Boot 3 namespace)
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.database=0
spring.data.redis.timeout=2s
spring.data.redis.repositories.enabled=false

keycloak.auth-server-url=http://localhost:8081
keycloak.realm=klb-bank
keycloak.resource=customer-service
keycloak.customer.client-secret=XbhXEZgtRvXrIluKfonzx95NAQSDrV7C

keycloak.admin.username=admin
keycloak.admin.password=admin
keycloak.admin.client-id=admin-cli

spring.security.oauth2.resourceserver.jwt.issuer-uri=${keycloak.auth-server-url}/realms/${keycloak.realm}

spring.main.allow-bean-definition-overriding=true

# Dubbo Configuration
dubbo.application.name=customer-service
dubbo.application.version=1.0.0

# Dubbo Registry - Nacos
dubbo.registry.address=nacos://localhost:8848
dubbo.registry.parameters.namespace=klb-bank
dubbo.registry.parameters.group=banking-services

# Dubbo Protocol (consumer only, no provider protocol needed)
dubbo.protocol.serialization=hessian2

# Dubbo Consumer Configuration
dubbo.consumer.timeout=5000
dubbo.consumer.retries=2
dubbo.consumer.check=false

# Dubbo Scan Configuration (scan events.producer for @DubboReference)
dubbo.scan.base-packages=com.example.customerservice.events.producer

# Dubbo Monitoring (optional)
dubbo.metadata-report.address=nacos://localhost:8848

# Spring Cloud OpenFeign
spring.cloud.openfeign.client.config.core-banking-service.connect-timeout=3000
spring.cloud.openfeign.client.config.core-banking-service.read-timeout=5000
spring.cloud.openfeign.circuitbreaker.enabled=true

# Resilience4j configuration for Feign clients
# Circuit Breaker for core-banking-service
resilience4j.circuitbreaker.instances.core-banking-service.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.core-banking-service.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.instances.core-banking-service.sliding-window-size=20
resilience4j.circuitbreaker.instances.core-banking-service.wait-duration-in-open-state=10s
resilience4j.circuitbreaker.instances.core-banking-service.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.core-banking-service.automatic-transition-from-open-to-half-open-enabled=true

# Retry for core-banking-service
resilience4j.retry.instances.core-banking-service.max-attempts=3
resilience4j.retry.instances.core-banking-service.wait-duration=500ms
resilience4j.retry.instances.core-banking-service.retry-exceptions[0]=feign.RetryableException
resilience4j.retry.instances.core-banking-service.retry-exceptions[1]=feign.FeignException


# Time Limiter for core-banking-service
resilience4j.timelimiter.instances.core-banking-service.timeout-duration=5s
resilience4j.timelimiter.instances.core-banking-service.cancel-running-future=true
