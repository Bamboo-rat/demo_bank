# Server Configuration
server.port=${SERVER_PORT:8086}
spring.application.name=loan-service

spring.cloud.compatibility-verifier.enabled=false

# Database Configuration - MySQL for Loan Service
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:mysql://localhost:3306/loan_db?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:root}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:123456}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPA / Hibernate Configuration
spring.jpa.hibernate.ddl-auto=${SPRING_JPA_HIBERNATE_DDL_AUTO:update}
spring.jpa.show-sql=${SPRING_JPA_SHOW_SQL:true}
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.jpa.properties.hibernate.format_sql=true

# Logging Configuration
logging.level.org.springframework=${LOGGING_LEVEL_SPRING:INFO}
logging.level.com.example.loanservice=${LOGGING_LEVEL_LOAN_SERVICE:DEBUG}
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# Nacos Discovery Configuration
spring.cloud.nacos.discovery.server-addr=${NACOS_SERVER_ADDR:localhost:8848}
spring.cloud.nacos.discovery.namespace=${NACOS_NAMESPACE:klb-bank}
spring.cloud.nacos.discovery.group=${NACOS_GROUP:banking-services}

# Feign Configuration
spring.cloud.openfeign.client.config.default.connect-timeout=5000
spring.cloud.openfeign.client.config.default.read-timeout=5000

# Feign Client URLs
spring.cloud.openfeign.client.config.account-service.url=http://localhost:8083
spring.cloud.openfeign.client.config.customer-service.url=http://localhost:8082
spring.cloud.openfeign.client.config.core-banking-service.url=http://localhost:8088

# Service URLs for Feign Clients
service.core-banking.url=http://localhost:8088

# Dubbo Configuration
dubbo.application.name=${DUBBO_APPLICATION_NAME:loan-service}
dubbo.application.version=${DUBBO_APPLICATION_VERSION:1.0.0}
dubbo.application.logger=slf4j

# Dubbo Registry - Using Nacos
dubbo.registry.address=nacos://${NACOS_SERVER_ADDR:localhost:8848}
dubbo.registry.parameters.namespace=${NACOS_NAMESPACE:klb-bank}
dubbo.registry.parameters.group=${NACOS_GROUP:banking-services}

# Dubbo Protocol Configuration
dubbo.protocol.name=dubbo
dubbo.protocol.port=20885
dubbo.protocol.serialization=hessian2

# Dubbo Consumer Configuration
dubbo.consumer.timeout=${DUBBO_CONSUMER_TIMEOUT:5000}
dubbo.consumer.retries=${DUBBO_CONSUMER_RETRIES:2}
dubbo.consumer.check=${DUBBO_CONSUMER_CHECK:false}

# Disable Dubbo Spring Security filter (we will pass auth info explicitly)
dubbo.provider.filter=-spring-security
dubbo.consumer.filter=-spring-security

dubbo.application.qos-enable=false

# SpringDoc OpenAPI Configuration
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.operationsSorter=method

# Keycloak OAuth2 Resource Server
spring.security.oauth2.resourceserver.jwt.issuer-uri=${KEYCLOAK_ISSUER_URI:http://localhost:8081/realms/klb-bank}
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${KEYCLOAK_JWK_SET_URI:http://localhost:8081/realms/klb-bank/protocol/openid-connect/certs}

# Kafka Configuration
spring.kafka.bootstrap-servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.acks=all
spring.kafka.producer.retries=3

# Kafka Topics
kafka.topics.loan-approved=loan.approved
kafka.topics.loan-disbursed=loan.disbursed
kafka.topics.loan-repayment-due=loan.repayment.due
kafka.topics.loan-repayment-success=loan.repayment.success
kafka.topics.loan-overdue=loan.overdue
kafka.topics.loan-closed=loan.closed

# Enable Scheduling
spring.task.scheduling.pool.size=5

# Loan Service Business Configuration
loan.interest.default-rate=10.0
loan.interest.min-rate=5.0
loan.interest.max-rate=25.0
loan.minimum-amount=10000000
loan.maximum-amount=1000000000
loan.minimum-term-months=6
loan.maximum-term-months=240
