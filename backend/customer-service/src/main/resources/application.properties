# Server
spring.application.name=customer-service
server.port=8082

#core-bank
core-banking.base-url=http://localhost:8088

# Datasource
spring.datasource.url=jdbc:mysql://localhost:3306/customer_db?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
spring.datasource.username=root
spring.datasource.password=123456
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPA / Hibernate
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# Logging
logging.level.org.springframework=INFO
logging.level.com.example.customerservice=DEBUG

# Redis
spring.redis.host=localhost
spring.redis.port=6379
spring.redis.database=0
spring.redis.timeout=2s
spring.redis.repositories.enabled=false

keycloak.auth-server-url=http://localhost:8081
keycloak.realm=klb-bank
keycloak.resource=customer-service
keycloak.customer.client-secret=XbhXEZgtRvXrIluKfonzx95NAQSDrV7C

keycloak.admin.username=admin
keycloak.admin.password=admin
keycloak.admin.client-id=admin-cli

spring.security.oauth2.resourceserver.jwt.issuer-uri=${keycloak.auth-server-url}/realms/${keycloak.realm}

# Dubbo Configuration
dubbo.application.name=customer-service
dubbo.application.version=1.0.0

# Dubbo Registry - Nacos
dubbo.registry.address=nacos://localhost:8848
dubbo.registry.parameters.namespace=klb-bank
dubbo.registry.parameters.group=banking-services

# Dubbo Protocol (consumer only, no provider protocol needed)
dubbo.protocol.serialization=hessian2

# Dubbo Consumer Configuration
dubbo.consumer.timeout=5000
dubbo.consumer.retries=2
dubbo.consumer.check=false

# Dubbo Scan Configuration (both adapter for @DubboService and service for @DubboReference)
dubbo.scan.base-packages=com.example.customerservice.adapter,com.example.customerservice.service

# Dubbo Monitoring (optional)
dubbo.metadata-report.address=nacos://localhost:8848

# Resilience4j configuration for core calls
# Circuit Breakers
resilience4j.circuitbreaker.instances.core-create-customer.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.core-create-customer.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.instances.core-create-customer.sliding-window-size=20
resilience4j.circuitbreaker.instances.core-create-customer.wait-duration-in-open-state=10s
resilience4j.circuitbreaker.instances.core-create-customer.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.core-create-customer.automatic-transition-from-open-to-half-open-enabled=true

resilience4j.circuitbreaker.instances.core-delete-customer.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.core-delete-customer.sliding-window-type=COUNT_BASED
resilience4j.circuitbreaker.instances.core-delete-customer.sliding-window-size=20
resilience4j.circuitbreaker.instances.core-delete-customer.wait-duration-in-open-state=10s
resilience4j.circuitbreaker.instances.core-delete-customer.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.core-delete-customer.automatic-transition-from-open-to-half-open-enabled=true

# Retries
resilience4j.retry.instances.core-create-customer.max-attempts=3
resilience4j.retry.instances.core-create-customer.wait-duration=250ms
resilience4j.retry.instances.core-create-customer.retry-exceptions=org.springframework.web.client.ResourceAccessException,org.springframework.web.client.HttpServerErrorException
resilience4j.retry.instances.core-create-customer.ignore-exceptions=org.springframework.web.client.HttpClientErrorException

resilience4j.retry.instances.core-delete-customer.max-attempts=3
resilience4j.retry.instances.core-delete-customer.wait-duration=250ms
resilience4j.retry.instances.core-delete-customer.retry-exceptions=org.springframework.web.client.ResourceAccessException,org.springframework.web.client.HttpServerErrorException
resilience4j.retry.instances.core-delete-customer.ignore-exceptions=org.springframework.web.client.HttpClientErrorException

# Time limiters
resilience4j.timelimiter.instances.core-create-customer.timeout-duration=3s
resilience4j.timelimiter.instances.core-create-customer.cancel-running-future=true

resilience4j.timelimiter.instances.core-delete-customer.timeout-duration=3s
resilience4j.timelimiter.instances.core-delete-customer.cancel-running-future=true
